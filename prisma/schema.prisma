// Pixelift PostgreSQL Schema
// Generated from lib/db.ts entities

generator client {
  provider = "prisma-client-js"
  output     = "../lib/generated/prisma"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

// ===================
// User Management
// ===================

enum UserRole {
  user
  premium
  admin
}

enum UserStatus {
  active
  banned
  suspended
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  displayName   String?   // User-editable display name/nickname
  image         String?
  password      String?   // Hashed password for email/password auth (bcrypt)
  role          UserRole  @default(user)
  status        UserStatus @default(active)
  credits       Int       @default(3)
  totalUsage    Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?
  firstUploadAt DateTime?

  // ========== GEOGRAPHIC & LOCATION DATA ==========
  country           String?   // ISO country code (PL, US, DE)
  countryName       String?   // Full country name
  region            String?   // State/Province/Region
  city              String?   // City name
  postalCode        String?   // Postal/ZIP code
  timezone          String?   // e.g., "Europe/Warsaw"
  latitude          Float?    // Approximate latitude
  longitude         Float?    // Approximate longitude

  // ========== DEVICE & TECHNICAL DATA ==========
  lastIpAddress     String?   // Last known IP (hashed for privacy)
  signupIpAddress   String?   // IP at registration
  userAgent         String?   // Full user agent string
  browser           String?   // Parsed browser name (Chrome, Firefox)
  browserVersion    String?   // Browser version
  os                String?   // Operating system (Windows, macOS, iOS)
  osVersion         String?   // OS version
  deviceType        String?   // desktop, mobile, tablet
  deviceBrand       String?   // Apple, Samsung, etc.
  deviceModel       String?   // iPhone 14, Galaxy S23
  screenResolution  String?   // e.g., "1920x1080"
  language          String?   // Browser language (pl, en-US)
  languages         String[]  @default([]) // All accepted languages

  // ========== ACQUISITION & MARKETING DATA ==========
  referralSource    String?   // utm_source or referrer domain
  referralMedium    String?   // utm_medium (cpc, organic, email)
  referralCampaign  String?   // utm_campaign
  referralTerm      String?   // utm_term (keywords)
  referralContent   String?   // utm_content
  landingPage       String?   // First page visited
  signupPage        String?   // Page where signup occurred
  referrerUrl       String?   // Full referrer URL
  gclid             String?   // Google Click ID
  fbclid            String?   // Facebook Click ID
  affiliateId       String?   // Affiliate tracking ID
  promoCode         String?   // Promo code used at signup

  // ========== ENGAGEMENT & BEHAVIOR DATA ==========
  totalSessions     Int       @default(0)  // Number of sessions
  totalPageViews    Int       @default(0)  // Total pages viewed
  totalTimeSpent    Int       @default(0)  // Total time in seconds
  avgSessionTime    Int       @default(0)  // Avg session in seconds
  lastActiveAt      DateTime? // Last activity (more granular than login)
  lastPageViewed    String?   // Last page URL
  bounceRate        Float?    // Calculated bounce rate

  // ========== BUSINESS & VALUE DATA ==========
  lifetimeValue     Float     @default(0)  // Total revenue from user
  totalSpent        Float     @default(0)  // Total money spent
  totalPurchases    Int       @default(0)  // Number of purchases
  avgPurchaseValue  Float     @default(0)  // Average order value
  firstPurchaseAt   DateTime? // First purchase date
  lastPurchaseAt    DateTime? // Last purchase date
  subscriptionTier  String?   // free, starter, pro, enterprise
  subscriptionStatus String?  // active, canceled, past_due
  subscriptionStartAt DateTime?
  subscriptionEndAt DateTime?
  trialEndsAt       DateTime? // Trial expiration
  churnRisk         Int?      // 0-100 churn probability
  customerSegment   String?   // VIP, regular, at-risk, new

  // ========== COMMUNICATION PREFERENCES ==========
  emailVerified     Boolean   @default(false)
  emailVerifiedAt   DateTime?
  phoneNumber       String?
  phoneVerified     Boolean   @default(false)
  emailNotifications Boolean  @default(true)
  pushNotifications Boolean   @default(false)
  smsNotifications  Boolean   @default(false)
  marketingConsent  Boolean   @default(false)
  marketingConsentAt DateTime?
  newsletterSubscribed Boolean @default(false)

  // ========== FEATURE USAGE DATA ==========
  preferredTools    String[]  @default([]) // Most used tools
  lastToolUsed      String?   // Last AI tool used
  favoritePreset    String?   // Most used preset
  totalImagesProcessed Int    @default(0)
  totalCreditsUsed  Int       @default(0)
  freeCreditsUsed   Int       @default(0)
  paidCreditsUsed   Int       @default(0)

  // ========== SOCIAL & AUTH DATA ==========
  googleId          String?   // Google OAuth ID
  facebookId        String?   // Facebook OAuth ID
  appleId           String?   // Apple OAuth ID
  linkedinId        String?   // LinkedIn OAuth ID
  githubId          String?   // GitHub OAuth ID
  authProvider      String?   // Primary auth method
  twoFactorEnabled  Boolean   @default(false)

  // ========== COMPANY/B2B DATA ==========
  companyName       String?
  companySize       String?   // 1-10, 11-50, 51-200, 201-500, 500+
  companyIndustry   String?
  jobTitle          String?
  department        String?
  vatNumber         String?
  billingAddress    String?

  // ========== NOTES & METADATA ==========
  internalNotes     String?   // Admin notes
  tags              String[]  @default([]) // Custom tags
  customFields      Json?     // Flexible custom data

  // Relations
  accounts      Account[]     // OAuth accounts (Google, Facebook, etc.)
  transactions  Transaction[]
  usages        Usage[]
  apiKeys       ApiKey[]
  tickets       Ticket[]
  referralsGiven Referral[] @relation("ReferrerRelation")
  referralsReceived Referral[] @relation("ReferredRelation")
  imageHistory  ImageHistory[]
  sessions      UserSession[]
  events        UserEvent[]
  pageViews     PageView[]

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([createdAt])
  @@index([country])
  @@index([referralSource])
  @@index([subscriptionTier])
  @@index([customerSegment])
  @@index([lastActiveAt])
  @@index([lifetimeValue])
}

// ===================
// Transactions
// ===================

enum TransactionType {
  purchase
  refund
  subscription
}

enum TransactionStatus {
  pending
  completed
  failed
  refunded
}

model Transaction {
  id          String            @id @default(cuid())
  userId      String
  type        TransactionType
  plan        String?
  amount      Float
  currency    String            @default("PLN")
  status      TransactionStatus @default(pending)
  stripeId    String?
  metadata    String?
  createdAt   DateTime          @default(now())
  completedAt DateTime?

  // Relations
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([stripeId])
}

// ===================
// Usage Tracking
// ===================

model Usage {
  id          String   @id @default(cuid())
  userId      String
  type        String
  creditsUsed Int
  imageSize   String?
  model       String?
  createdAt   DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

// ===================
// Image Processing History
// ===================

enum ImageProcessingStatus {
  pending
  processing
  completed
  failed
}

enum ImageProcessingType {
  upscale
  enhance
  restore
  background_remove
  compress
  packshot
}

model ImageHistory {
  id              String                 @id @default(cuid())
  userId          String
  type            ImageProcessingType
  status          ImageProcessingStatus  @default(pending)
  preset          String?
  scale           Int?

  // Original image info
  originalUrl     String
  originalWidth   Int?
  originalHeight  Int?
  originalSize    Int?
  originalFormat  String?

  // Processed image info
  processedUrl    String?
  processedWidth  Int?
  processedHeight Int?
  processedSize   Int?
  processedFormat String?

  // Processing details
  creditsUsed     Int                    @default(0)
  processingTime  Int?                   // in milliseconds
  model           String?                // AI model used
  settings        Json?                  // Additional settings
  error           String?

  // Timestamps
  createdAt       DateTime               @default(now())
  completedAt     DateTime?
  expiresAt       DateTime?              // When the image URLs expire

  // Relations
  user            User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}

// ===================
// Campaigns
// ===================

enum CampaignType {
  google_ads
  facebook_ads
  email
}

enum CampaignStatus {
  active
  paused
  completed
}

model Campaign {
  id          String         @id @default(cuid())
  name        String
  type        CampaignType
  status      CampaignStatus @default(active)
  budget      Float          @default(0)
  spent       Float          @default(0)
  impressions Int            @default(0)
  clicks      Int            @default(0)
  conversions Int            @default(0)
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([status])
  @@index([type])
  @@index([createdAt])
}

// ===================
// Notifications
// ===================

enum NotificationType {
  info
  warning
  error
  success
}

enum NotificationCategory {
  user
  system
  api
  marketing
  finance
}

model Notification {
  id        String               @id @default(cuid())
  type      NotificationType
  category  NotificationCategory
  title     String
  message   String
  read      Boolean              @default(false)
  metadata  Json?
  createdAt DateTime             @default(now())

  @@index([read])
  @@index([category])
  @@index([createdAt])
}

// ===================
// API Keys
// ===================

model ApiKey {
  id          String    @id @default(cuid())
  userId      String
  name        String
  keyHash     String    @unique  // SHA-256 hash of the key
  keyPrefix   String              // Display prefix (pk_live_xxxx...yyyy)
  environment String    @default("live") // "live" or "test"
  isActive    Boolean   @default(true)
  rateLimit   Int       @default(100)  // requests per minute
  usageCount  Int       @default(0)
  lastUsedAt  DateTime?
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([keyHash])
  @@index([isActive])
}

// ===================
// Feature Flags
// ===================

model FeatureFlag {
  id                String   @id @default(cuid())
  name              String
  key               String   @unique
  description       String
  enabled           Boolean  @default(false)
  rolloutPercentage Int      @default(0)
  targetUsers       String[] @default([])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([key])
  @@index([enabled])
}

// ===================
// Backups
// ===================

enum BackupType {
  manual
  automatic
}

model Backup {
  id          String     @id @default(cuid())
  name        String
  description String
  type        BackupType
  size        Int
  createdAt   DateTime   @default(now())
  createdBy   String
  data        Json

  @@index([type])
  @@index([createdAt])
}

// ===================
// Email Templates
// ===================

enum EmailTemplateCategory {
  transactional
  marketing
  system
}

enum EmailTemplateStatus {
  active
  draft
}

model EmailTemplate {
  id          String                @id @default(cuid())
  name        String
  slug        String                @unique
  subject     String
  htmlContent String
  textContent String
  variables   String[]              @default([])
  category    EmailTemplateCategory
  status      EmailTemplateStatus   @default(draft)
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  lastUsedAt  DateTime?
  usageCount  Int                   @default(0)

  @@index([slug])
  @@index([category])
  @@index([status])
}

// ===================
// Reports
// ===================

enum ReportType {
  users
  usage
  revenue
  campaigns
  custom
}

enum ReportFormat {
  pdf
  csv
  json
}

model Report {
  id               String       @id @default(cuid())
  name             String
  type             ReportType
  format           ReportFormat
  dateRangeStart   DateTime
  dateRangeEnd     DateTime
  filters          Json?
  createdAt        DateTime     @default(now())
  createdBy        String
  fileSize         Int?
  downloadCount    Int          @default(0)
  lastDownloadedAt DateTime?

  @@index([type])
  @@index([createdAt])
}

// ===================
// Webhooks
// ===================

model Webhook {
  id            String       @id @default(cuid())
  name          String
  url           String
  events        String[]
  enabled       Boolean      @default(true)
  secret        String?
  headers       Json?
  retryAttempts Int          @default(3)
  lastTriggered DateTime?
  successCount  Int          @default(0)
  failureCount  Int          @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  // Relations
  logs          WebhookLog[]

  @@index([enabled])
  @@index([createdAt])
}

enum WebhookLogStatus {
  success
  failed
  pending
}

model WebhookLog {
  id            String           @id @default(cuid())
  webhookId     String
  event         String
  payload       Json
  response      Json?
  status        WebhookLogStatus @default(pending)
  statusCode    Int?
  error         String?
  attemptNumber Int              @default(1)
  triggeredAt   DateTime         @default(now())

  // Relations
  webhook       Webhook          @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([status])
  @@index([triggeredAt])
}

// ===================
// A/B Tests
// ===================

enum ABTestType {
  page
  feature
  email
  cta
  custom
}

enum ABTestStatus {
  draft
  running
  paused
  completed
}

model ABTest {
  id           String       @id @default(cuid())
  name         String
  description  String
  type         ABTestType
  status       ABTestStatus @default(draft)
  targetMetric String
  targetUrl    String?
  startDate    DateTime?
  endDate      DateTime?
  winner       String?
  confidence   Float?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  createdBy    String

  // Relations
  variants     ABTestVariant[]

  @@index([status])
  @@index([type])
  @@index([createdAt])
}

model ABTestVariant {
  id          String  @id @default(cuid())
  testId      String
  name        String
  description String?
  traffic     Int     @default(50)
  conversions Int     @default(0)
  visitors    Int     @default(0)

  // Relations
  test        ABTest  @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
}

// ===================
// Content Moderation
// ===================

enum ModerationRuleType {
  keyword
  pattern
  ai
  custom
}

enum ModerationTarget {
  post
  comment
  user_profile
  all
}

enum ModerationSeverity {
  low
  medium
  high
  critical
}

enum ModerationAction {
  flag
  auto_approve
  auto_reject
  quarantine
}

model ModerationRule {
  id        String             @id @default(cuid())
  name      String
  type      ModerationRuleType
  target    ModerationTarget
  severity  ModerationSeverity
  action    ModerationAction
  keywords  String[]           @default([])
  pattern   String?
  aiPrompt  String?
  enabled   Boolean            @default(true)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  @@index([enabled])
  @@index([type])
  @@index([target])
}

enum ModerationQueueStatus {
  pending
  approved
  rejected
  flagged
}

enum ModerationContentType {
  post
  comment
  user_profile
  other
}

model ModerationQueue {
  id          String                 @id @default(cuid())
  contentType ModerationContentType
  contentId   String
  content     String
  author      String
  status      ModerationQueueStatus  @default(pending)
  flags       Json                   @default("[]")
  reviewedBy  String?
  reviewedAt  DateTime?
  notes       String?
  createdAt   DateTime               @default(now())

  @@index([status])
  @@index([contentType])
  @@index([createdAt])
}

// ===================
// Support Tickets
// ===================

enum TicketStatus {
  open
  in_progress
  resolved
  closed
}

enum TicketPriority {
  low
  medium
  high
  urgent
}

enum TicketCategory {
  technical
  billing
  feature_request
  bug
  other
}

model Ticket {
  id          String         @id @default(cuid())
  subject     String
  description String
  status      TicketStatus   @default(open)
  priority    TicketPriority @default(medium)
  category    TicketCategory
  userId      String
  userName    String
  userEmail   String
  assignedTo  String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  resolvedAt  DateTime?

  // Relations
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages    TicketMessage[]

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([createdAt])
}

model TicketMessage {
  id        String   @id @default(cuid())
  ticketId  String
  author    String
  isStaff   Boolean  @default(false)
  message   String
  createdAt DateTime @default(now())

  // Relations
  ticket    Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([createdAt])
}

// ===================
// Referral Program
// ===================

enum ReferralStatus {
  pending
  active
  converted
  expired
}

model Referral {
  id               String         @id @default(cuid())
  referrerId       String
  referrerName     String
  referredUserId   String?
  referredUserName String?
  referredEmail    String?
  code             String         @unique
  status           ReferralStatus @default(pending)
  clicks           Int            @default(0)
  signups          Int            @default(0)
  conversions      Int            @default(0)
  revenue          Float          @default(0)
  commission       Float          @default(0)
  commissionPaid   Boolean        @default(false)
  createdAt        DateTime       @default(now())
  convertedAt      DateTime?
  expiresAt        DateTime?

  // Relations
  referrer         User           @relation("ReferrerRelation", fields: [referrerId], references: [id], onDelete: Cascade)
  referredUser     User?          @relation("ReferredRelation", fields: [referredUserId], references: [id], onDelete: SetNull)

  @@index([referrerId])
  @@index([referredUserId])
  @@index([code])
  @@index([status])
}

// ===================
// User Session Tracking
// ===================

model UserSession {
  id              String    @id @default(cuid())
  userId          String

  // Session identification
  sessionToken    String    @unique
  fingerprint     String?   // Browser fingerprint hash

  // Timing
  startedAt       DateTime  @default(now())
  endedAt         DateTime?
  lastActivityAt  DateTime  @default(now())
  duration        Int       @default(0)  // in seconds

  // Device & Technical
  ipAddress       String?
  userAgent       String?
  browser         String?
  browserVersion  String?
  os              String?
  osVersion       String?
  deviceType      String?   // desktop, mobile, tablet
  screenResolution String?
  language        String?

  // Geographic
  country         String?
  countryName     String?
  region          String?
  city            String?
  timezone        String?
  latitude        Float?
  longitude       Float?

  // Traffic source (per session)
  referrer        String?
  utmSource       String?
  utmMedium       String?
  utmCampaign     String?
  utmTerm         String?
  utmContent      String?
  landingPage     String?
  exitPage        String?

  // Engagement
  pageViews       Int       @default(0)
  actions         Int       @default(0)   // clicks, form submits, etc.
  scrollDepthMax  Int?      // max scroll depth percentage
  bounced         Boolean   @default(false)
  converted       Boolean   @default(false)
  conversionType  String?   // signup, purchase, etc.
  conversionValue Float?

  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  events          UserEvent[]
  pages           PageView[]

  @@index([userId])
  @@index([sessionToken])
  @@index([startedAt])
  @@index([country])
  @@index([utmSource])
  @@index([converted])
}

// ===================
// User Event Tracking
// ===================

enum UserEventCategory {
  navigation      // page views, clicks
  engagement      // scroll, time spent, video play
  conversion      // signup, purchase, subscription
  tool_usage      // image processing, AI tools
  error           // client errors, API errors
  authentication  // login, logout, password reset
  account         // profile update, settings change
  payment         // payment attempt, success, failure
  api             // API key usage, rate limits
  custom          // custom events
}

model UserEvent {
  id              String            @id @default(cuid())
  userId          String
  sessionId       String?

  // Event identification
  eventName       String            // e.g., "button_click", "image_uploaded"
  eventCategory   UserEventCategory
  eventLabel      String?           // Additional label
  eventValue      Float?            // Numeric value if applicable

  // Context
  pageUrl         String?
  pageTitle       String?
  elementId       String?           // DOM element ID clicked
  elementClass    String?           // DOM element class
  elementText     String?           // Button text, link text

  // Technical
  ipAddress       String?
  userAgent       String?
  browser         String?
  os              String?
  deviceType      String?

  // Geographic
  country         String?
  city            String?

  // Tool-specific data
  toolType        String?           // upscale, enhance, restore, etc.
  toolPreset      String?
  toolSettings    Json?
  inputSize       Int?              // Input file size
  outputSize      Int?              // Output file size
  processingTime  Int?              // ms
  creditsUsed     Int?

  // Error tracking
  errorMessage    String?
  errorStack      String?
  errorCode       String?

  // Custom data
  metadata        Json?

  // Timing
  timestamp       DateTime          @default(now())
  clientTimestamp DateTime?         // Client-side timestamp

  // Relations
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  session         UserSession?      @relation(fields: [sessionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([sessionId])
  @@index([eventName])
  @@index([eventCategory])
  @@index([timestamp])
  @@index([toolType])
  @@index([country])
}

// ===================
// Page View Tracking
// ===================

model PageView {
  id              String       @id @default(cuid())
  userId          String
  sessionId       String?

  // Page identification
  pageUrl         String
  pagePath        String       // URL path without domain
  pageTitle       String?
  pageType        String?      // home, tool, pricing, blog, etc.

  // Referrer
  referrer        String?
  referrerDomain  String?

  // Technical
  ipAddress       String?
  userAgent       String?
  browser         String?
  os              String?
  deviceType      String?
  screenResolution String?
  viewportSize    String?

  // Geographic
  country         String?
  city            String?

  // Engagement
  timeOnPage      Int?         // seconds spent on page
  scrollDepth     Int?         // max scroll percentage (0-100)
  scrollEvents    Int          @default(0)
  clickEvents     Int          @default(0)
  formInteractions Int         @default(0)

  // Content engagement
  readTime        Int?         // estimated read time in seconds
  contentLength   Int?         // page content length
  imagesViewed    Int          @default(0)
  videosPlayed    Int          @default(0)
  videoWatchTime  Int          @default(0)

  // Exit behavior
  exitType        String?      // navigation, tab_close, timeout, external_link
  nextPage        String?      // Next page visited (if internal)

  // Timing
  enteredAt       DateTime     @default(now())
  exitedAt        DateTime?

  // Performance metrics
  loadTime        Int?         // page load time in ms
  timeToFirstByte Int?         // TTFB in ms
  domContentLoaded Int?        // DCL in ms
  largestContentfulPaint Int?  // LCP in ms
  firstInputDelay Int?         // FID in ms
  cumulativeLayoutShift Float? // CLS score

  // Custom data
  metadata        Json?

  // Relations
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  session         UserSession? @relation(fields: [sessionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([sessionId])
  @@index([pagePath])
  @@index([pageType])
  @@index([enteredAt])
  @@index([country])
}

// ===================
// SEO - Locale Configuration
// ===================

model SEOLocale {
  id              String   @id @default(cuid())
  code            String   @unique  // pl, en, es, fr, de, it...
  name            String            // Polski, English, EspaĂ±ol...
  nativeName      String?           // Polski, English, EspaĂ±ol...
  googleDomain    String            // google.pl, google.com...
  googleHL        String            // hl parameter
  googleGL        String            // gl parameter (country)
  flag            String            // Emoji flag

  isActive        Boolean  @default(true)
  priority        Int      @default(0)  // Sort order (lower = higher priority)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  keywords        TrackedKeyword[]

  @@index([isActive])
  @@index([code])
  @@index([priority])
}

// ===================
// SEO - Tracked Keywords
// ===================

model TrackedKeyword {
  id               String   @id @default(cuid())
  keyword          String
  domain           String   @default("pixelift.pl")
  localeCode       String   // Reference to SEOLocale.code

  // Current metrics (per locale!)
  currentPosition  Int?     // null = not in top 100
  previousPosition Int?
  bestPosition     Int?
  worstPosition    Int?

  // Search metrics (locale-specific)
  searchVolume     Int?     // monthly searches estimate for this locale
  difficulty       Int?     // 0-100 competition score
  cpc              Float?   // cost per click estimate
  trend            String?  // rising, falling, stable

  // Tracking config
  isActive         Boolean  @default(true)
  priority         String   @default("medium") // high, medium, low
  tags             String[] @default([])
  targetUrl        String?  // expected ranking URL (locale-specific)

  // Group keywords across locales
  groupId          String?  // Same keyword in different locales shares groupId

  // Timestamps
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  lastChecked      DateTime?

  // Relations
  locale           SEOLocale @relation(fields: [localeCode], references: [code])
  history          KeywordPositionHistory[]

  @@unique([keyword, domain, localeCode])
  @@index([domain])
  @@index([localeCode])
  @@index([isActive])
  @@index([currentPosition])
  @@index([groupId])
  @@index([priority])
  @@index([lastChecked])
}

model KeywordPositionHistory {
  id          String   @id @default(cuid())
  keywordId   String
  position    Int?     // null = not found in top 100
  url         String?  // URL that ranked
  title       String?  // SERP title
  snippet     String?  // SERP description
  features    String[] @default([]) // featured_snippet, local_pack, images, etc.
  checkedAt   DateTime @default(now())

  keyword     TrackedKeyword @relation(fields: [keywordId], references: [id], onDelete: Cascade)

  @@index([keywordId])
  @@index([checkedAt])
}

// ===================
// SEO - Backlinks
// ===================

model Backlink {
  id              String   @id @default(cuid())

  // Link details
  sourceUrl       String   // URL where link is found
  sourceDomain    String   // Domain of source
  targetUrl       String   // Our URL being linked
  targetDomain    String   @default("pixelift.pl")
  anchorText      String?

  // Metrics
  domainAuthority Int?     // 0-100
  pageAuthority   Int?     // 0-100
  spamScore       Int?     // 0-100

  // Link attributes
  isDoFollow      Boolean  @default(true)
  isSponsored     Boolean  @default(false)
  isUGC           Boolean  @default(false)
  linkType        String?  // text, image, redirect

  // Status tracking
  status          String   @default("active") // active, lost, broken, new
  firstSeen       DateTime @default(now())
  lastSeen        DateTime @default(now())
  lastChecked     DateTime @default(now())
  lostAt          DateTime?

  @@unique([sourceUrl, targetUrl])
  @@index([targetDomain])
  @@index([sourceDomain])
  @@index([status])
  @@index([firstSeen])
  @@index([lastChecked])
}

// ===================
// SEO - Site Audit
// ===================

model SiteAuditResult {
  id              String   @id @default(cuid())
  domain          String   @default("pixelift.pl")
  locale          String?  // Optional locale for locale-specific audits

  // Scores (0-100)
  overallScore    Int
  performanceScore Int
  seoScore        Int
  accessibilityScore Int
  bestPracticesScore Int

  // Issue counts
  criticalIssues  Int      @default(0)
  warningIssues   Int      @default(0)
  infoIssues      Int      @default(0)

  // Core Web Vitals
  lcp             Float?   // Largest Contentful Paint (seconds)
  fid             Float?   // First Input Delay (ms)
  cls             Float?   // Cumulative Layout Shift
  ttfb            Float?   // Time to First Byte (ms)
  inp             Float?   // Interaction to Next Paint (ms)

  // Page stats
  totalPages      Int      @default(0)
  indexedPages    Int      @default(0)
  brokenLinks     Int      @default(0)
  missingMeta     Int      @default(0)
  missingAlt      Int      @default(0)
  duplicateContent Int     @default(0)

  // Full results
  issues          Json     // Array of all issues
  pageResults     Json?    // Per-page audit results

  createdAt       DateTime @default(now())

  @@index([domain])
  @@index([locale])
  @@index([createdAt])
  @@index([overallScore])
}

// ===================
// SEO - Competitors
// ===================

model SEOCompetitor {
  id              String   @id @default(cuid())
  domain          String   @unique
  name            String
  description     String?

  // Estimated metrics
  domainAuthority Int?
  monthlyTraffic  Int?
  totalKeywords   Int?
  totalBacklinks  Int?

  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  rankings        CompetitorRanking[]

  @@index([isActive])
  @@index([domain])
}

model CompetitorRanking {
  id            String   @id @default(cuid())
  competitorId  String
  keyword       String
  localeCode    String   // Which locale this ranking is for
  position      Int?
  url           String?
  checkedAt     DateTime @default(now())

  competitor    SEOCompetitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([keyword])
  @@index([localeCode])
  @@index([checkedAt])
}

// ===================
// SEO - Reports
// ===================

model SEOReport {
  id              String   @id @default(cuid())
  name            String
  type            String   // weekly, monthly, custom
  domain          String   @default("pixelift.pl")
  locales         String[] @default([]) // Which locales included

  // Report period
  periodStart     DateTime
  periodEnd       DateTime

  // Summary metrics
  keywordsTracked Int
  avgPosition     Float?
  positionsUp     Int      @default(0)
  positionsDown   Int      @default(0)
  positionsStable Int      @default(0)
  newKeywords     Int      @default(0)
  lostKeywords    Int      @default(0)
  newBacklinks    Int      @default(0)
  lostBacklinks   Int      @default(0)

  // Full data
  data            Json

  // Delivery
  emailSent       Boolean  @default(false)
  sentAt          DateTime?
  recipients      String[] @default([])

  createdAt       DateTime @default(now())

  @@index([domain])
  @@index([type])
  @@index([createdAt])
  @@index([periodStart])
}

// =====================
// SOCIAL MEDIA HUB
// =====================

// Connected social accounts
model SocialAccount {
  id              String   @id @default(cuid())
  userId          String   // Owner

  platform        String   // facebook, instagram, twitter, linkedin, pinterest, tiktok, youtube, threads
  platformType    String   // page, profile, group, business
  accountId       String   // Platform-specific ID
  accountName     String
  accountHandle   String?  // @username
  avatarUrl       String?

  // Auth tokens (encrypted)
  accessToken     String
  refreshToken    String?
  tokenExpiry     DateTime?

  // Platform-specific data
  metadata        Json?    // followers, etc.

  isActive        Boolean  @default(true)
  isPrimary       Boolean  @default(false)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  posts           SocialPost[]
  analytics       SocialAnalytics[]

  @@unique([platform, accountId])
  @@index([userId])
  @@index([platform])
}

// Social posts
model SocialPost {
  id              String   @id @default(cuid())
  userId          String

  // Content
  content         String
  mediaUrls       String[]           // Images/videos
  mediaTypes      String[]           // image, video, carousel
  link            String?
  linkPreview     Json?              // title, description, image

  // Hashtags & mentions
  hashtags        String[]
  mentions        String[]

  // Location
  locationName    String?
  locationId      String?  // Platform location ID

  // Targeting
  accountId       String?
  account         SocialAccount? @relation(fields: [accountId], references: [id])

  // Status
  status          String   @default("draft") // draft, scheduled, publishing, published, failed, archived
  scheduledAt     DateTime?
  publishedAt     DateTime?

  // Platform-specific post IDs after publishing
  platformPostIds Json?    // { accountId: postId }

  // Engagement (updated periodically)
  totalLikes      Int      @default(0)
  totalComments   Int      @default(0)
  totalShares     Int      @default(0)
  totalReach      Int      @default(0)
  totalImpressions Int     @default(0)
  engagementRate  Float    @default(0)

  // Metadata
  isRecurring     Boolean  @default(false)
  recurringRule   String?  // RRULE format
  parentPostId    String?  // For recurring posts

  // AI-generated content tracking
  isAIGenerated   Boolean  @default(false)
  aiPrompt        String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([scheduledAt])
  @@index([accountId])
}

// Social Analytics (daily snapshots)
model SocialAnalytics {
  id              String   @id @default(cuid())
  accountId       String
  account         SocialAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  date            DateTime

  // Follower metrics
  followers       Int      @default(0)
  followersGrowth Int      @default(0)
  following       Int      @default(0)

  // Content metrics
  postsCount      Int      @default(0)

  // Engagement metrics
  totalLikes      Int      @default(0)
  totalComments   Int      @default(0)
  totalShares     Int      @default(0)

  // Reach metrics
  reach           Int      @default(0)
  impressions     Int      @default(0)
  profileVisits   Int      @default(0)
  websiteClicks   Int      @default(0)

  // Engagement rate
  engagementRate  Float    @default(0)

  @@unique([accountId, date])
  @@index([accountId])
  @@index([date])
}

// Brand Kit for Social Media
model BrandKit {
  id              String   @id @default(cuid())
  userId          String   @unique

  // Logo
  logoUrl         String?
  logoLightUrl    String?  // For dark backgrounds
  logoDarkUrl     String?  // For light backgrounds

  // Colors
  primaryColor    String?
  secondaryColor  String?
  accentColor     String?
  backgroundColor String?
  textColor       String?
  customColors    String[] // Additional brand colors

  // Typography
  headingFont     String?
  bodyFont        String?

  // Social defaults
  defaultHashtags String[]
  brandVoice      String?  // AI prompt for brand voice

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Hashtag Collections
model HashtagCollection {
  id              String   @id @default(cuid())
  userId          String

  name            String
  hashtags        String[]

  usageCount      Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
}

// Caption Templates
model CaptionTemplate {
  id              String   @id @default(cuid())
  userId          String

  name            String
  category        String?  // promotional, educational, engagement, etc.
  content         String

  variables       String[] // [name], [product], [link], etc.
  usageCount      Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
}

// ===================
// Google Integrations
// ===================

model GoogleIntegration {
  id                String   @id @default(cuid())

  // Service Account credentials (JSON)
  serviceAccountEmail String?
  serviceAccountKey   String?  @db.Text // Private key

  // Search Console
  searchConsoleEnabled   Boolean  @default(false)
  searchConsoleSiteUrl   String?  // e.g., https://pixelift.pl/
  searchConsoleVerified  Boolean  @default(false)

  // Analytics
  analyticsEnabled       Boolean  @default(false)
  analyticsPropertyId    String?  // GA4 property ID
  analyticsVerified      Boolean  @default(false)

  // OAuth tokens (alternative to service account)
  accessToken            String?  @db.Text
  refreshToken           String?  @db.Text
  tokenExpiry            DateTime?

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

// Search Console data cache
model SearchConsoleData {
  id              String   @id @default(cuid())

  date            DateTime
  query           String   // Search query/keyword
  page            String   // Landing page URL
  country         String   @default("") // Country code
  device          String   @default("") // desktop, mobile, tablet

  clicks          Int      @default(0)
  impressions     Int      @default(0)
  ctr             Float    @default(0)  // Click-through rate
  position        Float    @default(0)  // Average position

  createdAt       DateTime @default(now())

  @@unique([date, query, page, country, device])
  @@index([date])
  @@index([query])
  @@index([page])
}

// Analytics data cache
model AnalyticsData {
  id              String   @id @default(cuid())

  date            DateTime
  source          String   @default("") // Traffic source
  medium          String   @default("") // Traffic medium
  campaign        String   @default("") // Campaign name
  landingPage     String   @default("") // Landing page
  country         String   @default("") // Country
  device          String   @default("") // Device category

  sessions        Int      @default(0)
  users           Int      @default(0)
  newUsers        Int      @default(0)
  pageviews       Int      @default(0)
  bounceRate      Float    @default(0)
  avgSessionDuration Float @default(0)

  // Conversions
  conversions     Int      @default(0)
  conversionRate  Float    @default(0)
  revenue         Float    @default(0)

  createdAt       DateTime @default(now())

  @@unique([date, source, medium, landingPage, country, device])
  @@index([date])
  @@index([source])
  @@index([landingPage])
}

// =====================
// CONTENT HUB
// =====================

// Keyword Bank - storage for researched keywords
model KeywordBank {
  id              String   @id @default(cuid())
  keyword         String
  locale          String   // en, pl, es, fr

  // Metrics
  searchVolume    Int?
  difficulty      Int?     // 0-100 competition score
  cpc             Float?   // cost per click estimate

  // Classification
  intent          String?  // informational, transactional, commercial, navigational
  cluster         String?  // topic cluster name

  // Status tracking
  status          String   @default("new") // new, planned, writing, used, archived
  priority        Int      @default(0)     // 0-100, higher = more important

  // Source & metadata
  source          String?  // tag_recommender, manual, competitor_analysis, ai_suggestion
  relatedKeywords String[] @default([])
  serpFeatures    String[] @default([]) // featured_snippet, people_also_ask, images, videos
  trend           String?  // rising, stable, falling

  // Tracking
  lastChecked     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  usedInArticles  ContentArticleKeyword[]

  @@unique([keyword, locale])
  @@index([locale, status])
  @@index([cluster])
  @@index([priority])
  @@index([status])
}

// Keyword Clusters - grouping keywords by topic
model KeywordCluster {
  id          String   @id @default(cuid())
  name        String
  description String?
  locale      String
  color       String?  // hex color for UI
  parentId    String?  // for hierarchical clusters

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([name, locale])
  @@index([locale])
  @@index([parentId])
}

// Content Plan - planning articles before writing
model ContentPlan {
  id                String   @id @default(cuid())

  // Basic info
  title             String
  titleVariants     String[] @default([]) // A/B testing variants
  slug              String
  targetKeyword     String
  secondaryKeywords String[] @default([])

  // Content type & locale
  contentType       String   // blog, knowledge, tutorial, comparison, case-study, faq
  targetLocale      String   @default("en")

  // Status & scheduling
  status            String   @default("planned") // planned, researching, writing, review, published, archived
  priority          Int      @default(0)
  scheduledFor      DateTime?
  scheduledTimezone String?

  // Content planning
  outline           Json?    // article structure with headings
  brief             Json?    // detailed brief for AI writer
  serpAnalysis      Json?    // TOP 10 analysis data
  competitorUrls    String[] @default([])

  // Word count
  estimatedWords    Int?
  actualWords       Int?

  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  keywords          ContentArticleKeyword[]
  articles          ContentArticle[]

  @@index([status])
  @@index([targetLocale])
  @@index([scheduledFor])
  @@index([priority])
}

// Junction table for Content Plan <-> Keyword Bank
model ContentArticleKeyword {
  id            String      @id @default(cuid())
  keywordId     String
  contentPlanId String
  isPrimary     Boolean     @default(false)

  keyword       KeywordBank @relation(fields: [keywordId], references: [id], onDelete: Cascade)
  contentPlan   ContentPlan @relation(fields: [contentPlanId], references: [id], onDelete: Cascade)

  @@unique([keywordId, contentPlanId])
  @@index([contentPlanId])
}

// SERP Snapshot - cached SERP analysis
model SerpSnapshot {
  id              String   @id @default(cuid())
  keyword         String
  locale          String

  // Analysis results
  results         Json     // top 10 results with metadata
  avgWordCount    Int?
  commonHeadings  String[] @default([])
  commonQuestions String[] @default([])
  featuredSnippet Json?

  createdAt       DateTime @default(now())

  @@index([keyword, locale])
  @@index([createdAt])
}

// Content Article - the actual article content
model ContentArticle {
  id              String   @id @default(cuid())
  contentPlanId   String?

  // Basic info
  locale          String
  title           String
  slug            String
  content         String   @db.Text
  excerpt         String?  @db.Text

  // SEO
  metaTitle       String?
  metaDescription String?
  featuredImage   String?

  // Authorship
  author          String   @default("Pixelift Team")

  // Classification
  categories      String[] @default([])
  tags            String[] @default([])
  contentType     String   // blog, knowledge

  // Status
  status          String   @default("draft") // draft, review, scheduled, published, archived

  // Metrics
  wordCount       Int?
  seoScore        Int?     // 0-100
  readabilityScore Float?

  // AI tracking
  aiGenerated     Boolean  @default(false)
  aiModel         String?  // claude-sonnet-4-20250514, etc.

  // Publishing
  publishedAt     DateTime?
  scheduledAt     DateTime?

  // Translation tracking
  sourceArticleId String?  // ID of source article (for translations)
  isTranslation   Boolean  @default(false)

  // Version
  version         Int      @default(1)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  contentPlan     ContentPlan?     @relation(fields: [contentPlanId], references: [id], onDelete: SetNull)
  sourceArticle   ContentArticle?  @relation("ArticleTranslations", fields: [sourceArticleId], references: [id], onDelete: SetNull)
  translations    ContentArticle[] @relation("ArticleTranslations")
  versions        ContentArticleVersion[]
  optimizations   ContentArticleOptimization[]

  @@unique([slug, locale])
  @@index([status])
  @@index([locale])
  @@index([contentType])
  @@index([publishedAt])
  @@index([sourceArticleId])
}

// Article Version History
model ContentArticleVersion {
  id          String   @id @default(cuid())
  articleId   String
  version     Int
  content     String   @db.Text
  changes     String?  // description of changes
  wordCount   Int
  seoScore    Int?
  createdAt   DateTime @default(now())
  createdBy   String   // "ai_generation" | "ai_optimization" | "ai_refresh" | "manual" | userId

  article     ContentArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, version])
  @@index([articleId])
}

// Article Optimization History
model ContentArticleOptimization {
  id              String   @id @default(cuid())
  articleId       String

  initialScore    Int
  finalScore      Int
  iterations      Int
  improvements    Json     // what was improved
  qualityGates    Json     // quality gates results
  internalLinks   String[] @default([]) // links added

  createdAt       DateTime @default(now())

  article         ContentArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
}

// Content Alerts - notifications about content issues
model ContentAlert {
  id          String   @id @default(cuid())
  articleId   String?
  keyword     String?

  type        String   // position_drop, competitor_update, content_stale, keyword_opportunity
  severity    String   // high, medium, low
  message     String
  data        Json?    // additional context

  status      String   @default("new") // new, acknowledged, resolved, ignored

  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  resolvedBy  String?

  @@index([status, severity])
  @@index([articleId])
  @@index([createdAt])
}

// Content Publish Schedule
model ContentPublishSchedule {
  id          String   @id @default(cuid())
  articleId   String
  locale      String

  scheduledAt DateTime
  timezone    String
  status      String   @default("scheduled") // scheduled, publishing, published, failed, cancelled

  publishedAt DateTime?
  error       String?

  createdAt   DateTime @default(now())

  @@index([status, scheduledAt])
  @@index([articleId])
}

// Content Social Posts - generated social media content
model ContentSocialPost {
  id          String   @id @default(cuid())
  articleId   String

  platform    String   // twitter, linkedin, facebook, instagram
  content     String   @db.Text
  mediaUrls   String[] @default([])

  scheduledAt DateTime?
  status      String   @default("draft") // draft, scheduled, posting, posted, failed

  postedAt    DateTime?
  postUrl     String?  // URL to the published post
  error       String?

  // Engagement metrics (updated after posting)
  likes       Int      @default(0)
  comments    Int      @default(0)
  shares      Int      @default(0)
  clicks      Int      @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([articleId])
  @@index([platform])
  @@index([status, scheduledAt])
}

// ===================
// AI Video Generation
// ===================

enum VideoGenerationStatus {
  pending
  processing
  completed
  failed
  cancelled
}

model GeneratedVideo {
  id              String                 @id @default(cuid())

  // Ownership
  userId          String
  userEmail       String
  userName        String?

  // Input parameters
  prompt          String                 @db.Text
  enhancedPrompt  String?                @db.Text
  negativePrompt  String?

  // Model & Provider
  model           String                 // pixverse-v5, kling-2.5, veo-3.1, runway-gen4
  provider        String                 // replicate, piapi, runway
  modelVersion    String?

  // Video settings
  duration        Int                    // 5, 8, 10 seconds
  resolution      String                 // 360p, 540p, 720p, 1080p
  aspectRatio     String                 // 16:9, 9:16, 1:1
  fps             Int                    @default(24)
  withAudio       Boolean                @default(false)

  // Source image (for image-to-video)
  sourceImageUrl  String?
  sourceImagePath String?

  // Generation status
  status          VideoGenerationStatus  @default(pending)
  progress        Int                    @default(0) // 0-100
  jobId           String?                // Provider job ID for tracking
  webhookUrl      String?

  // Output
  videoUrl        String?                // Provider CDN URL
  localPath       String?                // Local file path
  thumbnailUrl    String?
  thumbnailPath   String?

  // Metadata
  fileSize        Int?                   // bytes
  actualDuration  Float?                 // actual duration in seconds
  processingTime  Int?                   // processing time in ms
  seed            Int?

  // Billing
  creditsUsed     Int                    @default(0)
  creditsReserved Int                    @default(0)
  costUSD         Float?                 // actual API cost

  // Social/Gallery
  isPublic        Boolean                @default(false)
  likes           Int                    @default(0)
  views           Int                    @default(0)
  likedBy         String[]               @default([])

  // Error handling
  errorMessage    String?
  errorCode       String?
  retryCount      Int                    @default(0)

  // Timestamps
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  completedAt     DateTime?

  @@index([userId])
  @@index([status])
  @@index([model])
  @@index([provider])
  @@index([isPublic, createdAt])
  @@index([jobId])
}

// ===================
// AI Music Generation
// ===================

enum MusicGenerationStatus {
  pending
  processing
  completed
  failed
  cancelled
}

enum MasteringStatus {
  none
  pending
  processing
  completed
  failed
}

model GeneratedMusic {
  id                String                @id @default(cuid())

  // Ownership
  userId            String
  userEmail         String
  userName          String?

  // Input parameters
  prompt            String                @db.Text
  enhancedPrompt    String?               @db.Text
  lyrics            String?               @db.Text  // Full lyrics with [Verse], [Chorus], etc.
  style             String?               // pop, rock, jazz, electronic, classical, etc.
  mood              String?               // happy, sad, energetic, calm, etc.
  referenceTrackUrl String?               // Optional reference track

  // Model & Provider
  model             String                // minimax-music-2.0
  provider          String                // fal
  modelVersion      String?

  // Music settings
  duration          Int                   // 60-300 seconds (1-5 min)
  bpm               Int?                  // beats per minute (60-200)
  key               String?               // C, D, E, F, G, A, B (major/minor)
  tempo             String?               // slow, medium, fast
  genre             String?               // More specific genre
  instrumental      Boolean               @default(false) // true = no vocals

  // Generation status
  status            MusicGenerationStatus @default(pending)
  progress          Int                   @default(0) // 0-100
  jobId             String?               // Provider job ID
  webhookUrl        String?

  // Output - Original
  audioUrl          String?               // Provider CDN URL
  localPath         String?               // Local file path
  waveformUrl       String?               // Waveform image
  coverImageUrl     String?               // AI-generated cover art

  // Mastering
  masteringStatus   MasteringStatus       @default(none)
  masteringIntensity String?              // lo, med, hi
  masteredUrl       String?               // Mastered audio URL
  masteredLocalPath String?               // Mastered audio local path
  masteringProvider String?               // landr, ai-mastering
  masteringJobId    String?               // Mastering job ID
  masteringCost     Float?                // USD cost for mastering

  // Metadata
  fileSize          Int?                  // bytes
  actualDuration    Float?                // actual duration in seconds
  processingTime    Int?                  // processing time in ms
  sampleRate        Int?                  // 44100, 48000 Hz
  bitDepth          Int?                  // 16, 24, 32 bit
  format            String?               // mp3, wav, flac
  seed              Int?

  // Billing
  creditsUsed       Int                   @default(0)
  creditsReserved   Int                   @default(0)
  costUSD           Float?                // actual API cost

  // Organization
  folderId          String?               // Optional folder organization
  title             String?               // User-defined title
  description       String?               // User description

  // Social/Gallery
  isPublic          Boolean               @default(true)
  likes             Int                   @default(0)
  views             Int                   @default(0)
  plays             Int                   @default(0)
  likedBy           String[]              @default([])

  // Error handling
  errorMessage      String?
  errorCode         String?
  retryCount        Int                   @default(0)

  // Extension/Continuation
  parentTrackId     String?               // Parent track for extensions
  extendedFromTime  Int?                  // Timestamp (seconds) where extension starts
  extensionNumber   Int?                  // 1, 2, 3... for chain tracking
  isExtension       Boolean               @default(false)
  sunoClipId        String?               // Suno clip ID for extend API

  // Timestamps
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  completedAt       DateTime?
  masteredAt        DateTime?

  // Relations
  folder            MusicFolder?          @relation(fields: [folderId], references: [id], onDelete: SetNull)
  parentTrack       GeneratedMusic?       @relation("TrackExtensions", fields: [parentTrackId], references: [id], onDelete: SetNull)
  extensions        GeneratedMusic[]      @relation("TrackExtensions")

  @@index([userId])
  @@index([status])
  @@index([model])
  @@index([provider])
  @@index([isPublic, createdAt])
  @@index([folderId])
  @@index([jobId])
  @@index([parentTrackId])
}

model MusicFolder {
  id          String    @id @default(cuid())
  userId      String
  name        String
  description String?
  color       String?   // hex color for UI
  coverImage  String?   // folder cover image
  isDefault   Boolean   @default(false)

  // Metadata
  trackCount  Int       @default(0)
  totalDuration Int     @default(0) // total seconds

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  tracks      GeneratedMusic[]

  @@unique([userId, name])
  @@index([userId])
}

// ===================
// Admin Audit Logging
// ===================

model AuditLog {
  id          String   @id @default(cuid())
  adminId     String
  adminEmail  String
  action      String   // user.create, user.delete, api_key.revoke, etc.
  targetType  String?  // user, api_key, feature_flag, ticket, etc.
  targetId    String?  // ID of the affected resource
  details     String?  @db.Text // JSON string with additional details
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([adminId])
  @@index([action])
  @@index([targetType])
  @@index([targetId])
  @@index([createdAt])
}

// ===================
// Email Verification Tokens
// ===================

model EmailVerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  email     String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

// ===================
// Password Reset Tokens
// ===================

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  email     String
  expiresAt DateTime
  usedAt    DateTime? // When the token was used
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

// ===================
// OAuth Accounts (NextAuth compatible)
// ===================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String  // "oauth" | "credentials"
  provider          String  // "google" | "facebook" | "credentials"
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}
